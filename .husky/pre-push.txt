#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîé Pre-push: verifying builds (API + Web)..."
set -e

# API
if [ -f "apps/api/package.json" ]; then
  echo "‚û°Ô∏è  Building API..."
  cd apps/api
  npm ci --silent
  npm test || echo "‚ö†Ô∏è  No tests defined for API, skipping..."
  npm run -s build
  cd ../..
else
  echo "‚ÑπÔ∏è  Skipping API (no package.json)"
fi

# Web
if [ -f "apps/web/package.json" ]; then
  echo "‚û°Ô∏è  Building Web..."
  cd apps/web
  npm ci --silent
  npm test || echo "‚ö†Ô∏è  No tests defined for Web, skipping..."
  npm run -s build
  cd ../..
else
  echo "‚ÑπÔ∏è  Skipping Web (no package.json)"
fi

echo "‚úÖ Pre-push checks passed."
